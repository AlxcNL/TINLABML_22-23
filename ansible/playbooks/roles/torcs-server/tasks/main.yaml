# https://github.com/vog3lm/torcs-1.3.7
---
- name: Update bashrc for plib
  ansible.builtin.blockinfile:
    path: /home/{{ ansible_user_id }}/.bashrc
    block: | 
      export CFLAGS='-fPIC'
      export CPPFLAGS='\$CFLAGS'
      export CXXFLAGS='\$CFLAGS'

- name: Check if torcs directory exists
  stat:
    path: "/home/{{ ansible_user_id }}/torcs"    
  register: torcs_dir

- name: Git checkout torcs
  ansible.builtin.git:
    repo: https://github.com/fmirus/torcs-1.3.7.git
    dest: "/home/{{ ansible_user_id }}/torcs"
  when: torcs_dir.stat.exists == false

- name: configure
  become: True
  ansible.builtin.shell:
    cmd: ./configure
    chdir: /home/{{ ansible_user_id }}/torcs

- name: make
  community.general.make:
    chdir: /home/{{ ansible_user_id }}/torcs
    
- name: make install 
  become: True
  community.general.make:
    chdir: /home/{{ ansible_user_id }}/torcs
    target: install

- name: make datainstall
  become: True
  community.general.make:
    chdir: /home/{{ ansible_user_id }}/torcs
    target: datainstall